# AI智能择优选择器改进任务

## 任务背景
用户发现AI选择器生成功能总是返回XPath而非CSS/Regex/Full Text，希望AI能够智能择优选择最适合的选择器类型。

## 用户需求
- AI应该根据元素特征智能推荐最适合的选择器类型
- 确保生成的选择器都是可用且准确的，避免"找不到"的问题
- 只需要CSS选择器和XPath，不需要正则表达式和全文匹配

## 实施方案

### 后端改进
1. **更新AI服务模型** (`backend/app/services/ai_selector.py`)
   - 简化SelectorResponse模型，只保留css_selector和xpath
   - 添加recommended_type字段用于AI推荐
   - 添加type_analysis字段用于分析结果

2. **增强AI提示词逻辑**
   - CSS选择器适用场景：有稳定id/class、简单DOM结构、高性能需求
   - XPath适用场景：需要文本匹配、复杂逻辑、向上遍历、CSS无法表达
   - 要求AI对每种选择器评分并推荐最优类型

3. **更新API响应格式** (`backend/app/api/selector.py`)
   - 返回recommended_type和type_analysis
   - 移除regex_pattern和full_text字段

### 前端改进
1. **更新界面显示** (`frontend/src/views/SelectorView.vue`)
   - 突出显示AI推荐的选择器类型（🌟标记）
   - 显示每种选择器的评分和选择理由
   - 移除正则表达式和全文匹配相关界面

2. **优化用户体验**
   - 推荐类型用不同颜色标签区分
   - 显示AI的分析理由
   - 保留所有选择器的复制和测试功能

## 技术实现要点

### AI择优逻辑
- CSS选择器评分标准：有稳定属性+简单结构=高分
- XPath评分标准：复杂结构+需要文本匹配=高分
- 推荐类型为评分最高的选择器类型

### 质量保证
- 每个选择器都必须经过AI验证确保可用
- 置信度必须>=90才返回结果
- 提供详细的选择理由和适用性分析

## 预期效果
- AI能够根据元素特征智能推荐最适合的选择器类型
- 用户可以看到AI的分析过程和推荐理由
- 所有生成的选择器都是可用且准确的
- 界面更加清晰，突出显示推荐选项

## 新增功能：父容器选择

### 用户需求
用户希望能够选择整个表格行或列表项，而不是单个单元格。

### 实现方案
1. **智能父容器检测** - 自动向上查找最多5层父元素
2. **可视化选择界面** - 在弹出框中显示所有可选的父容器
3. **智能推荐** - 优先显示表格行(tr)、列表项(li)等常用容器

### 技术实现
- 修改`showPopover`函数，添加父容器选择选项
- 新增`getParentContainerOptions`函数，获取可选父容器
- 更新`confirmSelection`函数，支持用户选择的目标元素
- 添加样式优化显示效果

### 使用方法
1. 点击表格单元格或列表项中的任意元素
2. 在弹出框中选择目标元素（当前元素或父容器）
3. 选择监控类型
4. 确认生成选择器

## 状态
✅ 已完成 - 2024-06-13
✅ 父容器选择功能已添加 - 2024-06-13
