api_settings:
  deepseek_api_key: sk-33c4b6f409f149cf89139fb4c4900439
  deepseek_base_url: https://api.deepseek.com
  deepseek_model: deepseek-chat
  openai_api_key: sk-6KwYGpsonYqWBAxrg9hEyjfEL7Bpak478TjuxCA7gf52GdvGVDfQ
  openai_base_url: https://api.oaipro.com/v1
  openai_model: claude-sonnet-4-20250514
  ai_provider: openai
default_notification:
  enabled: true
  telegram:
    enabled: false
    bot_token: null
    chat_id: null
  feishu:
    enabled: true
    webhook: https://open.feishu.cn/open-apis/bot/v2/hook/2e9f09a8-4cec-4475-a6a8-4da61c4a874c
tasks:
- name: 华为快应用加载器监控
  url: https://developer.huawei.com/consumer/cn/doc/Tools-Library/quickapp-ide-download-0000001101172926
  frequency: 1m
  rule: xpath://*[@id="ZH-CN_TOPIC_0000001101172926__li16222518142"]
  rules: null
  enabled: false
  screenshot: false
  notification_title: 华为
  notification: null
  storage_strategy: file
  ai_analysis_enabled: true
  ai_description: 我想监控华为快应用加载器的最新版本更新,当最新版本号发生变化时（如从V15.1.1.301变为V15.2.1.305），请生成一个合适的飞书通知，包含：版本号（V15.1.1.301类似这样）、规范版本（类似1121）、发现时间、下载地址。通知格式要求：包含emoji、简洁美观。
  ai_extraction_rules: null
  ai_formatter_code: null
- name: 荣耀调试器
  url: https://developer.honor.com/cn/doc/guides/101380
  frequency: 1m
  rule: xpath://*[@id="doc-content-text"]/div[2]/table/tbody/tr[2]
  rules: null
  enabled: false
  screenshot: false
  notification_title: 荣耀
  notification: null
  storage_strategy: file
  ai_analysis_enabled: true
  ai_description: 我只想监控荣耀加载器的最新版本更新。当最新版本号发生变化时（如从V15.1.1.301变为V15.2.1.305），请生成一个适用于飞书的通知格式，包含：荣耀快应用引擎版本号、荣耀引擎版本号、快应用联盟平台版本号、下载地址、调试器版本号、版本功能、检测时间。通知格式要求：包含emoji、简洁美观、版本功能需要排版
  ai_extraction_rules: null
  ai_formatter_code: null
- name: OPPO
  url: https://ie-activity-cn.heytapimage.com/static/minigame/CN/docs/index.html#/download/index
  frequency: 1m
  rule: xpath://*[@id="main"]/ul[1]
  rules: null
  enabled: true
  screenshot: false
  notification_title: OPPO快游戏
  notification: null
  storage_strategy: file
  ai_analysis_enabled: true
  ai_description: "监控OPPO小游戏调试器版本更新。当版本号发生变化时，生成飞书通知。\n\n版本说明：\n- 大版本号：1155、1166这样的数字\n- 小版本号：V9.8.0、V9.0.0这样的格式\n\n通知内容要求：\n1. OPPO引擎大版本号\n2. OPPO引擎小版本号  \n3. 下载地址（必须格式化为超链接：[点击下载](实际URL)）\n4. 检测时间\n\n格式要求：使用emoji装饰，布局简洁美观，适合飞书显示。"
  ai_extraction_rules:
    major_version: css:ul li:first-child code
    link_text: css:ul li:first-child a
    download_url: css:ul li:first-child a::attr(href)
  ai_formatter_code: "def format_notification(extracted_data: dict, task_info: dict) -> str:\n\n    try:\n        # 获取基础数据\n        major_version = extracted_data.get('major_version', '未知')\n        link_text = extracted_data.get('link_text', '')\n        download_url = extracted_data.get('download_url', '')\n\n        # 从链接文本中提取小版本号\n        minor_version = '未知'\n        if link_text:\n            version_match = re.search(r'V\\d+\\.\\d+\\.\\d+', link_text)\n            if version_match:\n                minor_version = version_match.group()\n\n        # 格式化下载链接\n        download_link = '[点击下载](' + download_url + ')' if download_url else '下载链接不可用'\n\n        # 获取当前时间\n        current_time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')\n\n        # 构建通知内容\n        notification = '\U0001F3AE **OPPO小游戏调试器版本更新**\\n\\n'\n        notification += '\U0001F4CA **版本信息**\\n'\n        notification += '• 大版本号:**' + str(major_version) + '**\\n'\n        notification += '• 小版本号:**' + str(minor_version) + '**\\n\\n'\n        notification += '\U0001F4E5 **下载地址**\\n'\n        notification += download_link + '\\n\\n'\n        notification += '\U0001F550 **检测时间**\\n'\n        notification += current_time\n\n        return notification\n\n    except Exception as e:\n        return '❌ 通知生成失败:' + str(e)"
- name: 华为快应用引擎更新说明
  url: https://developer.huawei.com/consumer/cn/doc/quickApp-Guides/quickapp-version-updates-0000001079803874
  frequency: 1m
  rule: css:#body0000001079803874 > div:nth-child(1)
  rules:
  - css:#body0000001079803874 > div:nth-child(1)
  - css:#body0000001079803874 > div:nth-child(2)
  enabled: false
  screenshot: false
  notification_title: 华为快应用引擎更新说明
  notification: null
  storage_strategy: file
  ai_analysis_enabled: true
  ai_description: '我想监控华为快应用引擎的版本更新说明，当最新版本号发生变化时（如从1121版本变为1122版本），请生成一个合适的飞书通知，包含：


    1. **版本号**：从版本标题中提取（如从"1121版本更新说明（2025-6-6）"中提取"1121"）

    2. **更新内容**：提取最新版本区块内所有表格的"说明"列内容，包括变更描述和参考链接

    3. **检测时间**：当前检测时间


    通知格式要求：包含emoji、更新内容分条目显示并美观换行、简洁美观。'
  ai_extraction_rules: null
  ai_formatter_code: "def format_notification(extracted_data: dict, task_info: dict) -> str:\n    try:\n\n        page_content = extracted_data.get('page_content', '')\n\n        # 解析分段内容\n        sections = {}\n        current_section = None\n        current_content = []\n\n        for line in page_content.split('\\n'):\n            line = line.strip()\n            if line.startswith('=== 提取规则'):\n                if current_section is not None:\n                    sections[current_section] = '\\n'.join(current_content)\n                match = re.search(r'=== 提取规则 (\\d+):', line)\n                if match:\n                    current_section = int(match.group(1))\n                    current_content = []\n            elif line and current_section is not None:\n                current_content.append(line)\n\n        if current_section is not None:\n            sections[current_section] = '\\n'.join(current_content)\n\n        # 从分段1提取版本号和日期\n        version_number = \"未知版本\"\n        update_date = \"未知日期\"\n\n        if 1 in sections:\n            title_content = sections[1]\n            # 提取版本号\n            version_match = re.search(r'(\\d+)版本更新说明', title_content)\n            if version_match:\n                version_number = version_match.group(1)\n\n            # 提取日期\n            date_match = re.search(r'((\\d{4}-\\d{1,2}-\\d{1,2}))', title_content)\n            if date_match:\n                update_date = date_match.group(1).strip('()')\n\n        # 从分段2提取表格说明内容\n        update_items = []\n\n        if 2 in sections:\n            table_content = sections[2]\n\n            # 提取表格行\n            rows = re.findall(r'<tr[^>]*>.*?</tr>', table_content, re.DOTALL)\n\n            for row in rows:\n                if 'cellrowborder' in row and 'thead' not in row:\n                    # 提取变更点\n                    change_point_match = re.search(r'<p[^>]*>([^<]+)</p>', row)\n                    change_point = change_point_match.group(1).strip() if change_point_match else \"\"\n\n                    # 提取说明内容\n                    td_cells = re.findall(r'<td[^>]*>(.*?)</td>', row, re.DOTALL)\n                    if len(td_cells) >= 2:\n                        description_cell = td_cells[1]\n\n                        # 提取列表项\n                        list_items = re.findall(r'<li[^>]*>([^<]+)</li>', description_cell)\n\n                        # 提取参考链接\n                        link_match = re.search(r'<a href=\"([^\"]+)\">([^<]+)</a>', description_cell)\n\n                        if change_point and (list_items or link_match):\n                            item_text = f\"**{change_point}**\"\n\n                            if list_items:\n                                for item in list_items:\n                                    item_text += f\"\\n  • {item.strip()}\"\n\n                            if link_match:\n                                link_url = link_match.group(1)\n                                link_text = link_match.group(2)\n                                item_text += f\"\\n  \U0001F4D6 参考文档:[{link_text}]({link_url})\"\n\n                            update_items.append(item_text)\n\n        # 生成通知内容\n        current_time = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n        notification = f\"\U0001F680 **华为快应用引擎更新通知**\\n\\n\"\n        notification += f\"\U0001F4E6 **版本号**:{version_number}\\n\"\n        notification += f\"\U0001F4C5 **发布日期**:{update_date}\\n\"\n        notification += f\"\U0001F550 **检测时间**:{current_time}\\n\\n\"\n\n        if update_items:\n            notification += f\"\U0001F4CB **更新内容**:\\n\\n\"\n            for i, item in enumerate(update_items, 1):\n                notification += f\"{i}. {item}\\n\\n\"\n        else:\n            notification += f\"\U0001F4CB **更新内容**:暂无详细信息\\n\\n\"\n\n        notification += f\"---\\n\U0001F4A1 华为快应用引擎版本 {version_number} 已发布,请及时关注相关变更！\"\n\n        return notification\n\n    except Exception as e:\n        return f\"⚠️ 华为快应用引擎更新通知解析失败:{str(e)}\""
